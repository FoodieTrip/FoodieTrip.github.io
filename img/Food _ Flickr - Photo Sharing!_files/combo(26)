YUI.add("basic-book-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,attributes:{title:{},owner:{},coverPhoto:{isModel:!0},coverPhotoDeleted:{defaultFn:function(){return!1}},cropW:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropH:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropX:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},cropY:{setter:function(e){return Math.abs(e)||0},getter:function(e){return parseFloat(e,10)||0},defaultFn:function(){return 0},defaultValue:0},totalPages:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-books-fetcher","flickr-products-books-updateBook-updater","flickr-products-books-editBook-updater"]});
YUI.add("flickr-creations-fetcher",function(e,t){"use strict";function n(t){var n={extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=[],d=[],v=[];return r&&r.stat==="ok"&&(p=Object.keys(r.wallart_ids).map(function(e){return r.wallart_ids[e]}),e.Array.each(p,function(t,n){if(t.photoSource===2)return;var r,i,s,u=[],p=!1,v,m,g,y={};r=a.addOrUpdate({id:t.owner}),t.photo.id?(y={photos:[t.photo],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c,photoCurationModelRegistry:h},t.photo.ownerId&&(y.ownerID=t.photo.ownerId),i=e.APIHelper.response.parsePhotos(y)[0]):p=!0,t.orders&&typeof t.orders=="object"&&(s=Object.keys(t.orders).map(function(e){return t.orders[e]}),e.Array.each(s,function(e){u.push({orderId:e.orderId,orderStatus:e.order.statusOrder,dateCreate:e.dateCreate,dateUpdate:e.dateUpdate})})),t.skuId.substr(-2)==="CC"?(v=t.skuId.slice(0,-3),m=!0):t.skuId.substr(-2)==="MK"?(v=t.skuId.slice(0,-3),g=!0):v=t.skuId,d.push(o.addOrUpdate({id:t.wallartId,owner:r,photo:i,photoDeleted:p,skuId:v,isCC:m,isMK:g,orientation:t.orientation,price:t.price,cropW:t.photo.cropW,cropH:t.photo.cropH,cropX:t.photo.cropX,cropY:t.photo.cropY,isEditable:t.isEditable,isLowQuality:t.isLowQuality,created:t.dateCreate,updated:t.dateUpdate,orders:u,photoSource:t.photoSource}))})),i&&i.stat==="ok"&&e.Array.each(i.books.book,function(t,n){var r=!1,i,s;i=a.addOrUpdate({id:t.owner}),t.coverPhoto.id?s=e.APIHelper.response.parsePhotos({photos:[t.coverPhoto],personModelRegistry:a,photoModelRegistry:f,photoEngagementModelRegistry:l,photoStatsModelRegistry:c})[0]:r=!0,v.push(u.addOrUpdate({id:t.id,title:t.title,owner:i,coverPhoto:s,coverPhotoDeleted:r,totalPages:t.countPages,created:t.dateCreate,updated:t.dateUpdate,cropW:t.coverPhoto.cropW/100,cropH:t.coverPhoto.cropH/100,cropX:t.coverPhoto.cropX/100,cropY:t.coverPhoto.cropY/100}))}),s.addOrUpdate({id:n.id,wallarts:d,books:v}),{wallarts:d,books:v}}function i(n,r){var i=this,s=this._processParams(n);return e.Promise.all([r.callAPI("flickr.products.wallart.getList",s,!0),r.callAPI("flickr.products.books.getList",s,!0),r.getModelRegistry("creations-models"),r.getModelRegistry("wallart-models"),r.getModelRegistry("basic-book-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-creations"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["creations-models","wallart-models","basic-book-models","person-models","photo-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("creations-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-creations"].run(t,this.appContext)}},removeCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").remove(e)}),n.books&&e.Array.each(n.books,function(e,n){r.getValue(t,"books").remove(e)})},appendCreations:function(t,n){var r=this;n.wallarts&&e.Array.each(n.wallarts,function(e,n){r.getValue(t,"wallarts").unshift(e)})},attributes:{wallarts:{isCollection:!0},books:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-promise","model-proxy","flickr-model-registry","flickr-creations-fetcher"],optional:["wallart-models","basic-book-models"]});
YUI.add("flickr-products-wallart-create-creator",function(e,t){"use strict";function r(e){var t={};return e=e||{},t.photo_id=e.photoId,t.sku_id=e.skuId,t}function i(e,t,r){var i=e[0],s=e[1],o=e[2],u=e[3],a=t.nsid,f,l,c,h,p=!1,d=!1,v=e[4],m,g;return i?(f=i.wallart,c=o.exists(a)?o.proxy(a):o.add({id:a}),l=u.exists(t.photoId)?u.proxy(t.photoId):u.add({id:t.photoId}),f.skuId.substr(-2)==="CC"?(h=f.skuId.slice(0,-3),p=!0):f.skuId.substr(-2)==="MK"?(h=f.skuId.slice(0,-3),d=!0):h=f.skuId,s.exists(f.wallartId)?(s.setValues(f.wallartId,{owner:c,photo:l,skuId:h,isCC:p,isMK:d,orientation:f.orientation,photoSource:f.photoSource}),g=s.proxy(f.wallartId)):g=s.add({id:f.wallartId,owner:c,photo:l,skuId:h,isCC:p,isMK:d,orientation:f.orientation,created:f.dateCreate,photoSource:f.photoSource}),v.exists(a)&&(m=v.proxy(a),m.appendCreations({wallarts:[s.proxy(f.wallartId)]}))):(n.warn("No API response?"),g=this),g}function s(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.wallart.create",this._processParams(n)),r.getModelRegistry("wallart-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("creations-models")]).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}var n=require("lib/flog")(t);e.namespace("ModelCreators")["flickr-products-wallart-create"]={run:s,_processParams:r,_processResponse:i}},"@VERSION@",{requires:["flickr-promise","wallart-models"],optional:["person-models","photo-models","creations-models"]});
YUI.add("flickr-products-wallart-editWallart-updater",function(e,t){"use strict";function n(e,t,n){var r=e.response,i=e.wallartModelRegistry;i.exists(t)&&i.setValue(t,"price",r.wallart.price);if(this.pendingUpdate)return this.pendingUpdate=!1,this.startNextUpdate(t,n)}function r(e,t){return t.getModel("wallart-models",e).then(function(e){var t,n,r,i,s;return n=e.getValue("photo"),i=e.getValue("isCC"),s=e.getValue("isMK"),r=e.getValue("skuId"),i===!0?r+="_CC":s===!0&&(r+="_MK"),t={wallart_id:e.id,photo:{id:n.getValue("id"),owner:n.getValue("owner").getValue("id"),crop_x:e.getValue("cropX"),crop_y:e.getValue("cropY"),crop_h:e.getValue("cropH"),crop_w:e.getValue("cropW")},sku_id:r,orientation:e.getValue("orientation"),is_low_quality:e.getValue("isLowQuality")},{wallart:JSON.stringify(t)}})}function i(n,r){var i=this;return this.serialize(n,r).then(function(s){return(new e.FlickrPromise({response:r.callAPI("flickr.products.wallart.update",s),wallartModelRegistry:r.getModelRegistry("wallart-models")})).then(function(e){return i.processResponse(e,n,r)},function(e){throw i.pendingUpdate&&(i.pendingUpdate=!1),e}).then(null,e.FetcherErrorLogger(t))})}function s(){return this.updateInFlight=null,!0}function o(e,t){return this.updateInFlight=this.callAPI(e,t).then(this.clearUpdateInFlight.bind(this),this.clearUpdateInFlight.bind(this)),this.updateInFlight}function u(e,t){return this.pendingUpdate=null,this.startUpdate(e,t)}function a(e,t){return this.pendingUpdate?this.updateInFlight:this.updateInFlight?(this.pendingUpdate=!0,this.updateInFlight):this.startUpdate(e,t)}e.namespace("ModelUpdaters")["flickr-products-wallart-editWallart"]={run:a,serialize:r,callAPI:i,clearUpdateInFlight:s,startUpdate:o,processResponse:n,startNextUpdate:u}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("wallart-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-products-wallart"].run(t,this.appContext)},create:function(t){return e.ModelCreators["flickr-products-wallart-create"].run(t,this.appContext)},update:function(t,n){return e.ModelUpdaters["flickr-products-wallart-editWallart"].run(t,this.appContext)}},attributes:{owner:{isModel:!0},photo:{isModel:!0},photoDeleted:{defaultFn:function(){return!1}},isCC:{defaultFn:function(){return!1}},isMK:{defaultFn:function(){return!1}},photoSource:{},skuId:{},orientation:{},price:{},cropW:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropH:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropX:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},cropY:{setter:function(e){return Math.abs(parseFloat(e,10))},defaultFn:function(){return 0}},isLowQuality:{defaultFn:function(){return 0}},isEditable:{defaultFn:function(){return!0}},isDeleted:{defaultFn:function(){return!1}},invalidForPrintReason:{},isInvalidForPrint:{},created:{getter:function(e){return parseInt(e,10)}},updated:{getter:function(e){return parseInt(e,10)}},orders:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-products-wallart-fetcher","flickr-products-wallart-create-creator","flickr-products-wallart-editWallart-updater"]});
YUI.add("flickr-products-wallart-fetcher",function(e,t){"use strict";function n(t){var n={wallart_id:t.id,return_deleted:1,extras:e.APIHelper.request.getRebootPhotoExtras()};return n}function r(t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=r.wallart,c,h,p,d,v=!1,m=!1,g={};if(l)return p=s.addOrUpdate({id:l.owner}),g={photos:[l.photo],personModelRegistry:s,photoModelRegistry:o,photoEngagementModelRegistry:u,photoStatsModelRegistry:a,photoCurationModelRegistry:f},l.photo.ownerId&&(g.ownerID=l.photo.ownerId),h=e.APIHelper.response.parsePhotos(g)[0],l.skuId.substr(-2)==="CC"?(d=l.skuId.slice(0,-3),v=!0):l.skuId.substr(-2)==="MK"?(d=l.skuId.slice(0,-3),m=!0):d=l.skuId,c={id:l.wallartId,owner:p,photo:h,skuId:d,isCC:v,isMK:m,orientation:l.orientation,price:l.price,cropW:l.photo.cropW,cropH:l.photo.cropH,cropX:l.photo.cropX,cropY:l.photo.cropY,isEditable:l.isEditable,isDeleted:l.isDeleted,isLowQuality:l.isLowQuality,photoSource:l.photoSource,created:l.dateCreate},i.addOrUpdate(c),c}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.products.wallart.getDetails",this._processParams(n)),r.getModelRegistry("wallart-models"),r.getModelRegistry("person-models"),r.getModelRegistry("photo-models"),r.getModelRegistry("photo-engagement-models"),r.getModelRegistry("photo-stats-models"),r.getModelRegistry("photo-curation-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-products-wallart"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["wallart-models","photo-models","person-models","photo-engagement-models","photo-stats-models","photo-curation-models"]});
YUI.add("photo-engagement-view",function(e,t){var n=require("lib/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.signinPendingQueue=e.signinPendingQueue,this},subviewConfig:{"fave-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,hideWhoFaved:!0},"photo-well-scrappy-edit-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e=this.get("photo"),t=e.getValue("owner"),n=e.getValue("isMarketplaceLicensable")&&this.appContext.flipper.getValue("licensing-button-placement")==="toolbar",r;return r={"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):"",photoId:e.getValue("id"),ownerId:e.getValue("owner").getValue("id"),isVideo:e.getValue("isVideo"),viewerIsOwner:t.getValue("isMe"),canCreateWallart:this.canCreateWallart(),isWallartLowQuality:this.isWallartLowQuality(),downloadingAvailable:!1,downloadLink:"",showLicenseButton:n,marketplaceLicensingUrl:e.getValue("marketplaceLicensingUrl")},e.getValue("isVideo")?(r.downloadLink="/video_download.gne?id="+e.getValue("id"),this.appContext.flipper.isFlipped("enable-album-download")&&(r.downloadingAvailable=e.getValue("engagement").getValue("canDownload")),t.getValue("isMe")&&(r.downloadingAvailable=!0)):(r.downloadLink=e.getValue("url")+"/sizes/l/",r.downloadingAvailable=!0),this.appContext.forceServerRender&&(r.downloadItems=this.getDownloadMenuItems()),this.setContainerWithTemplate("photo-engagement",r),r.canCreateWallart&&this.get("container").addClass("has-wallart"),n&&this.get("container").addClass("has-buyable"),this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var e=this.get("photo").getValue("license"),t=e!==0&&e!==7&&e!==8&&e!==10,n=e===9,r=e===10,i=this.get("container");if(this.signinPendingQueue&&this.signinPendingQueue.length>0){var s=this.signinPendingQueue;for(var o=0;o<s.length;o++)s[o].key==="download"&&s[o].value&&s[o].value.id===this.photoId&&this.downloadItem(s[o].value.imageUrl)}return this.appContext.flipper.isFlipped("enable-signed-out-download-cta-test")&&!this.appContext.getViewer().signedIn&&!this.appContext.getUA().isBot&&this.get("photo").getValue("owner").getValue("isPro")!==!0&&!t&&!n&&!r&&this.get("photo").getValue("visibilitySource")!==2&&(this.signedOutTest=!0),this.createDownloadDialog(this.getDownloadMenuItems()),this.registerEventHandler(i.all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this)),this.attachKeyEvent("down:68",this.handleDownloadMenuButtonClick.bind(this)),this.registerEventHandler(i.delegate("click",this.handleDownloadMenuButtonClick.bind(this),".download a")),this.registerEventHandler(i.delegate("click",this.createWallartClick.bind(this),".wallart a")),this.registerEventHandler(this.get("photo").on("valuesChanged",function(e){e.isMarketplacePrintable&&e.isMarketplacePrintable.newVal===!0&&(this.buildContainer(),this.getDownloadMenuItems(),this.get("container").all(".sizes li a.download-image-size").on("click",this.handleDownloadItemClick,this))}.bind(this))),this.signedOutTest&&this.registerEventHandler(i.one(".all-sizes").on("click",function(e){e.halt(),this.signUpAndDownloadItem()}.bind(this))),this.appContext.flipper.isFlipped("display-marketplace-licensable")&&i.one(".photoListLicenseButton")&&(this.registerEventHandler(i.one(".photoListLicenseButton").on("click",this.licenseButtonClick,this)),this.registerEventHandler(i.one(".photoListLicenseButton").on("mouseenter",this.licenseButtonHover,this)),this.registerEventHandler(i.one(".photoListLicenseButton").on("mouseleave",this.licenseButtonHover,this))),this},licenseButtonHover:function(t){var n=300;t.halt();var r=t.type,i=this;if(r==="mouseenter"){if(e.StorageHelper.getItem("seenThirdParty"))return;this.tooltip&&this.tooltip.close(),clearTimeout(this.tooltipHoverTimer),this.isHovering=!0,this.tooltipHoverTimer=setTimeout(function(){i.isHovering&&(i.tooltip=new e.Views.FluidDroparound({appContext:i.appContext,showDropArrow:!0,dismissOnOverlayClick:!1,dismissOnActionClick:!1,observePageResize:!0,anchorElement:t.target,positionFixed:!0,closeOnScroll:!0,hideModalOverlay:!0,invisibleOverlay:!0,autoSizeToContent:!0,useAnchorOffsetSize:!0,horizCenterToAnchor:!0,preferTop:!0,classList:"photo-license-pop-up",textMessage:i.intlMessage({intlName:"common.CLICK_BUTTON_THIRD_PARTY"})}),i.tooltip.show())},n)}else this.isHovering=!1,this.tooltip&&this.tooltip.close()},licenseButtonClick:function(t){var r={owner_id:t.target.getData("ownerid"),photo_id:t.target.getData("photoid")};this.appContext.callAPI("flickr.licensing.marketplace.addClick",r).then(function(){e.StorageHelper.setItem("seenThirdParty",1)},function(e){n.error("flickr.licensing.marketplace.addClick failed",{photoId:r.photo_id})})},canCreateWallart:function(){var e=!1,t,n=this.appContext.getViewer(),r,i,s,o,u;return t=this.get("photo"),t&&n&&(i=!1,r=t.getValue("owner").getValue("isMe"),s=t.getValue("isMarketplacePrintable"),u=t.getValue("safetyLevel")===0,o=!t.getValue("isVideo"),this.appContext.flipper.isFlipped("creative-commons-wallart")?r?this.appContext.getViewer().signedIn&&o&&(e=!0):i?this.appContext.getViewer().signedIn&&o&&u&&(e=!0):s&&this.appContext.getViewer().signedIn&&o&&u&&(e=!0):this.appContext.getViewer().signedIn&&r&&o&&(e=!0)),e},isWallartLowQuality:function(){var t=this.get("photo");return this.wallartHelper||(this.wallartHelper=new e.WallartHelper),this.wallartHelper.isPhotoWallartable(t).skus.length===0?!0:!1},createWallartClick:function(n){var r=this,i="/create/wallart/",s=this.get("photo"),o;n.halt(),e.rapidTracker.beacon(
t,"createWallartClick");if(s.getValue("hasInvalidColorspaceForPrint"))return this.handleLacksWallartability("COLORSPACE");this.wallartHelper||(this.wallartHelper=new e.WallartHelper(this.appContext));if(this.wallartHelper.isPhotoWallartable(s).skus.length===0)return this.handleLacksWallartability("LOW_QUALITY");this.appContext.getModelRegistry("wallart-models").then(function(t){t.remoteCreate({nsid:r.appContext.getViewer().nsid,photoId:s.getValue("id")}).then(function(t){i+=t.getValue("id")+"/edit",YUI.Env.isServer||(!r.appContext.secure&&window.location.host===e.config.flickr.url.host?e.config.win.location.href=i:r.appContext.flapp.navigate(i))},function(t){o=new e.Views.FluidModal({appContext:r.appContext,darkOverlay:!0,dismissOnOverlayClick:!0,actionButtonLabel:r.intlMessage({intlName:"common.OK"}),title:r.intlMessage({intlName:"common.UPLOAD_ERROR_TITLE"}),message:"There was a problem creating your wall art. Please try again later."}),o.show()})})},handleLacksWallartability:function(t){var n,r;t==="LOW_QUALITY"?r="Looks like this photo doesn't meet the minimum requirements to get printed. Please choose a photo that's at least 975 &times; 825 pixels. Learn more about <a href='http://help.yahoo.com/kb/index?page=content&y=PROD_FLICKR&locale=en_US&id=SLN22567'>requirements</a> for print products.":t==="COLORSPACE"&&(r="Sorry, we cannot print photos with a CMYK or ProPhoto RGB colorspace. We recommend photos with an sRGB color space. <a href='https://help.yahoo.com/kb/flickr/creations-faq-sln22216.html?impressions=true#cont33'>Learn more</a>."),n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,showCancelX:!0,title:"Try a different photo",message:r,classList:"lacks-wallartability"}),n.show()},getDownloadMenuItems:function(t){var n=e.clone(this.get("photo").toJSON()),r,i=[],s,o=this.get("photo").getValue("engagement").getValue("canDownload"),u=!1;if(!n||!n.sizes)return"";n.sizes.q&&(n.sizes.q.label=this.intlMessage({intlName:"photo-page-scrappy.SQUARE"}),i.push(n.sizes.q)),n.sizes.s&&(n.sizes.s.label=this.intlMessage({intlName:"photo-page-scrappy.SMALL"}),i.push(n.sizes.s)),n.sizes.z&&(n.sizes.z.label=this.intlMessage({intlName:"photo-page-scrappy.MEDIUM"}),i.push(n.sizes.z)),n.sizes.k?(n.sizes.k.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.k)):n.sizes.h?(n.sizes.h.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.h)):n.sizes.l&&(n.sizes.l.label=this.intlMessage({intlName:"photo-page-scrappy.LARGE"}),i.push(n.sizes.l)),n.sizes.o&&(n.sizes.o.label=this.intlMessage({intlName:"photo-page-scrappy.ORIGINAL"}),i.push(n.sizes.o));for(s=0;s<i.length;s++)i[s].url=i[s].displayUrl.replace(/^(.+)(\..+)$/,"$1_d$2");return o&&(u=!0),r=this.templates("scrappy-download-menu")({photo:n,sizes:i,showDownloadSizes:u}),r},createDownloadDialog:function(t){var n=this.get("container"),r=this;this.downloadMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:t,anchorTo:n.one(".download"),dropUp:!0,parent:this,positioning:!1,rootEl:n}),this.downloadMenu.render(),this.downloadMenu.on("toggle",function(e){e&&e.details&&e.details.length>0&&(e.details[0]?r.fire("subviewViewEvent","make in view",n):r.fire("subviewViewEvent","close in view"))})},handleDownloadMenuButtonClick:function(n){var r=this.get("photo"),i;if(n.target.ancestor(".download",!0).hasClass("disabled"))n.preventDefault();else if(r.getValue("isVideo"))if(!this.appContext.flipper.isFlipped("enable-album-download")){i=r.getValue("owner").getValue("isMe");if(!i)return n.preventDefault(),!1}else this.handleDownloadItemClick(n);else n.halt(),this.downloadMenu.toggle();e.rapidTracker.beacon(t,"downloadDialogClick")},handleDownloadItemClick:function(n){n.preventDefault();var r;r=n.currentTarget.getAttribute("href"),this.signedOutTest?this.signUpAndDownloadItem(r):this.downloadItem(r),e.rapidTracker.beacon(t,"photoDownloadClick"),this.downloadMenu.hide()},downloadItem:function(e){document.location=e},signUpAndDownloadItem:function(t){var n=this,r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_TITLE"}),i=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_MESSAGE"}),s,o;this.get("photo").getValue("isVideo")&&this.appContext.lang.toLowerCase()==="en-us"&&(r=this.intlMessage({intlName:"photo-page-scrappy.SIGNUP_AND_DOWNLOAD_VIDEO_TITLE"})),s=e.url(e.URLHelper.getPhotoPage({photoId:this.photoId,pathAlias:this.nsid})),o=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-download",signUpTitle:r,signUpMessage:i,beaconPrefix:"download"}),o.on("signUpClick",function(r){t?e.SigninHelper.signUpPendingDownload({id:n.photoId,imageUrl:t},{postLoginUrl:s}):e.SigninHelper._redirectToSignUp("download",{postLoginUrl:s+"sizes/l/"})}),o.on("signInClick",function(r){t?e.SigninHelper.addPendingDownload({id:n.photoId,imageUrl:t},{postLoginUrl:s}):e.SigninHelper._redirectToSignin("download",{postLoginUrl:s+"sizes/l/"})}),o.show()}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-engagement","hermes-template-download-dialog","hermes-template-scrappy-download-menu","wallart-helper","photo-engagement-css","signup-modal-view","fluid-share-photo-view","fluid-droparound-view","better-throttle"],optional:["photo-models","wallart-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("seo",function(e,t){e.Seo={appContext:{},getSEOTitleForPhoto:function(e,t,n,r){var i=e.getValue("og:title"),s=e.getValue("og:description"),o="",u="| Flickr",a=70,f=a-(i.length+u.length+5);return i==="Untitled"&&(i=r),i.length>50?o=i.slice(0,58)+(i.length<58?" ":"\u2026 "):i.length>20&&i.length<50?s.length>20?o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 "):o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 ")+"| "+n+" ":i.length<=20&&(s.length>50?o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 "):o=i+" | "+s.slice(0,f)+(s.length<f?" ":"\u2026 ")+"| "+n+" "),o},generateSEODescriptionForPhoto:function(e,t,n,r,i){var s=e.getValue("og:title"),o=e.getValue("og:description"),u="",a=160;return s==="Untitled"&&(s=r),o.length>120?u=o.slice(0,120)+(o.length<120?" ":"\u2026 ")+n+" "+i+".":o.length>60&&o.length<120?u=o+(o.slice(o.length-1,o.length)==="."?" ":". ")+s.slice(0,40)+(s.length<40?" ":"\u2026 ")+n+" "+i+".":o.length<=60&&(u=s+(s.slice(s.length-1,s.length)==="."?" ":". ")+o.slice(0,a-s.length)+(o.length<a-s.length?" ":"\u2026 ")+n+" "+i+"."),u}}},"@VERSION@",{requires:[]});
YUI.add("hermes-template-empty-photo-page",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["global-nav-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<div class="fluid-centered" style="text-align: center;">\n	<h3>'+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.TIMEOUT_FAILURE"},data:i}))+"</h3>\n</div>\n\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["footer-full-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/empty-photo-page",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","photo-css","util-css","overflow-helper","url","fluid-css"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(t!=null?t:{},t!=null?t["photo-well-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" no-click"},3:function(e,t,n,r,i){return" is-hidden"},5:function(e,t,n,r,i){return" is-video"},7:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-url"]||(t!=null?t["prev-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-url",hash:{},data:i}):s))},9:function(e,t,n,r,i){return"#"},11:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-title"]||(t!=null?t["prev-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-title",hash:{},data:i}):s))},13:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-url"]||(t!=null?t["next-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-url",hash:{},data:i}):s))},15:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-title"]||(t!=null?t["next-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-title",hash:{},data:i}):s))},17:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return((s=n["if"].call(o,t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-toggle-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-actions-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["people-notes-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"},18:function(e,t,n,r,i){return'	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<a class="navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n'+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(o,t!=null?t["photo-well-media-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<a class="navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n'+((s=n.unless.call(o,t!=null?t["is-ad"]:t,{name:"unless",hash:{},fn:e.program(17,i,0),inverse:e.noop,data:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,r,i){return"	Please continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+((s=n["if"].call(t!=null?t:{},t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"<br>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<form action="//'+f((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s===a?s.call(o,{name:"host",hash:{},data:i}):s))+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="'+f((s=(s=n["redirect-url"]||(t!=null?t["redirect-url"]:t))!=null?s:u,typeof s===a?s.call(o,{name:"redirect-url",hash:{},data:i}):s))+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return'	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:i}))+"</h2>\n"+((s=n["if"].call(o,t!=null?t.isSignedIn:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"		</div>\n	</div>\n"},2:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:i}))+"<br />"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:i}))+"</p>\n\n"+((s=n.unless.call(o,t!=null?t.isMinor:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")},3:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"					<p><button class='ui-button'><span>"+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:i}))+"</span></button></p>\n					<p>"+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:i}))+"</p>\n"},5:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:i}))+' <a href="//'+a((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"host",hash:{},data:i}):s))+'/signin/" data-track="photoWellSignInClick">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a></p>\n"},7:function(e,t,n,r,i){var s,o=t!=null?t:{};return"\n"+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")},8:function(e,t,n,r,i){var s;return'		<a class="ad-wrapper" href="'+e.escapeExpression(e.lambda((s=t!=null?t.ad:t)!=null?s.clickUrl:s,t))+'">\n'},10:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'			<div class="videoplayer main-photo" style="width:'+f((s=(s=n.width||(t!=null?t.width:t))!=null?s:u,typeof s===a?s.call(o,{name:"width",hash:{},data:i}):s))+"px; height:"+f((s=(s=n.height||(t!=null?t.height:t))!=null?s:u,typeof s===a?s.call(o,{name:"height",hash:{},data:i}):s))+'px;"></div>\n'},12:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l="function";return'\n			<div class="facade-of-protection-neue '+((s=n["if"].call(u,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+f((n.outlet||t&&t.outlet||a).call(u,t!=null?t["zoom-view"]:t,{name:"outlet",hash:{},data:i}))+'\n			</div>\n\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.src||(t!=null?t.src:t))!=null?o:a,typeof o===l?o.call(u,{name:"src",hash:{},data:i}):o))+'" class="low-res-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<noscript>\n				<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			</noscript>\n'},13:function(e,t,n,r,i){return"is-video"},15:function(e,t,n,r,i){var s;return'			<span class="ad-info">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{brand:(s=t!=null?t.ad:t)!=null?s.brand:s,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:i}))+"</span>\n		</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e,t){var n=require("lib/flog")(t),r=500,i=500,s=100,o;o={photo:{render:function(){var t=this,n=this.get("photo"),r,i,o=new Date,u="";return t.preloadImage&&(t.preloadImage.onload=null),r=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(n.getValue("title").trim()===""?u=this.intlMessage({intlName:"common.UNTITLED"}):u=n.getValue("title"),u+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:i.url,highResSrc:r.url,imgAltText:u,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",r),YUI.Env.isServer?(this.serverWidth=r.width,this.serverHeight=r.height):n.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0;var n,i="photoPageShowedSize",u="\u00f8";try{n=/(?:_([a-z]))?\.jpg/.exec(r.url),n&&n[1]&&(u=n[1])}catch(a){}finally{i+=String(u).toUpperCase()}e.rapidTracker.beacon(this.name,i);var f=t.get("container").one(".low-res-photo"),l=t.get("container").one(".main-photo"),c=new Date-o,h;c<s?(l.removeClass("is-hidden").show(),f.hide()):(l.setStyles({position:"absolute",left:0,top:0,opacity:0}),l.removeClass("is-hidden"),h=function(){l.removeAttribute("style"),f.hide()},e.UA.ie?h():e.use("transition",function(e){l.transition({duration:.25,opacity:1},h)}))},t.preloadImage.src=r.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var t=this,n=this.get("photo"),r=this.getPhotoForDisplay({excludeSizes:[]});return this.player?(this.player.resize(r.width,r.height),this):(this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:r.url,needsInterstitial:n.getValue("needsInterstitial"),isVideo:n.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",r),YUI.Env.isServer?this:(this.player=new e.FlickrVideoPlayer({container:this.get("container").one(".videoplayer"),model:n,appContext:this.appContext}),t.player.init().then(function(){t}),this.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)}),this))}},ad:{render:function(){var e,t;return this.adJSON?e=this.adJSON:(e=this.appContext.adManager.getAdJSON(),this.adJSON=e),t=this.getAdSize(e),this.setContainerWithTemplate("photo-well-ad",{width:t.width,height:t.height,src:e.url,clickUrl:e.clickUrl,brand:e.brand,adsTypeB:this.appContext.flipper.isFlipped("moneyball-ads-type-b")}),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-scrappy-zoom")},disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?o.ad.render.call(this):o[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var r=this,i=this.get("personPreferences"),s=this.get("photo"),o=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),i.setValue("safeSearch",o),i.registry.remoteUpdate(r.appContext.auth.user.nsid).then(function(e){var t=s.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){s.registry.getValue(e,"safetyLevel")<=i.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),r.buildContainer()},function(e){n.error({err:e}),r.onError(r.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=this;this.fire("subviewViewEvent","getDialogOffset",function(r){var i=e.Views.dialog.getInstance("dialog-alert",{content:t,attrs:{title:n.intlMessage({intlName:"common.ERROR"}),level:"warning",confirmLabel:n.intlMessage({intlName:"common.OK"})},parent:n,offsetLeft:r});i.show()})},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/
n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getAdSize:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=80,i=140,s,o;return this.appContext.flipper.isFlipped("moneyball-ads-type-b")&&(t.height-=(r+i)*n,t.width-=i*n),s=Math.min(t.height/n,e.height),o=Math.min(t.width/n,e.width/e.height*s),s=Math.min(s,e.height/e.width*o),{width:o,height:s}},getCanvasSize:function(){var e,t=this.getPixelRatio(),n;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(n=this.get("container").ancestor(),n&&(e=n.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:t})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:i,right:r,width:parseInt(this.appContext.getCookie("photoPW"),10)||r,height:parseInt(this.appContext.getCookie("photoPH"),10)||i}),e.height*=t,e.width*=t,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","flickr-video-player","hermes-template-photo-well-ad","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-lang-attribution_zh-hant-hk",function(e,t){e.Intl.add("hermes/attribution","zh-Hant-HK",{FOLLOW:["\u8ffd\u8e64"],FOLLOWING:["\u6b63\u5728\u8ffd\u8e64"],ERROR_SETTING_FRIEND:["\u8a2d\u5b9a\u670b\u53cb\u95dc\u4fc2\u6642\u767c\u751f\u554f\u984c"],ERROR_SETTING_FAMILY:["\u8a2d\u5b9a\u670b\u53cb\u95dc\u4fc2\u6642\u767c\u751f ",{type:"number",valueName:"POPULATION",format:"integer"}," \u554f\u984c"],FRIEND:["\u670b\u53cb"],FAMILY:["\u5bb6\u4eba"],UNFOLLOW:["\u53d6\u6d88\u8ffd\u8e64"],GO_TO_PHOTOSTREAM:["\u79fb\u81f3 ","${name}"," \u7684\u6240\u6709\u76f8\u7247"],BY_USER:["\u76f8\u7247\u64c1\u6709\u8005\uff1a","${user}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-head-link",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return'id="'+e.escapeExpression((s=(s=n.id||(t!=null?t.id:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"id",hash:{},data:i}):s))+'"'},3:function(e,t,n,r,i){var s;return'rev="'+e.escapeExpression((s=(s=n.rev||(t!=null?t.rev:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"rev",hash:{},data:i}):s))+'"'},5:function(e,t,n,r,i){var s;return'rel="'+e.escapeExpression((s=(s=n.rel||(t!=null?t.rel:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"rel",hash:{},data:i}):s))+'"'},7:function(e,t,n,r,i){var s;return'type="'+e.escapeExpression((s=(s=n.type||(t!=null?t.type:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"type",hash:{},data:i}):s))+'"'},9:function(e,t,n,r,i){var s;return'media="'+e.escapeExpression((s=(s=n.media||(t!=null?t.media:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"media",hash:{},data:i}):s))+'"'},11:function(e,t,n,r,i){var s;return'href="'+e.escapeExpression((s=(s=n.href||(t!=null?t.href:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"href",hash:{},data:i}):s))+'"'},13:function(e,t,n,r,i){return'data-dynamic-added-by="'+e.escapeExpression((n.obfuscateInternals||t&&t.obfuscateInternals||n.helperMissing).call(t!=null?t:{},t!=null?t.addedBy:t,{name:"obfuscateInternals",hash:{},data:i}))+'"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return"<link "+((s=n["if"].call(o,t!=null?t.id:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.rev:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.rel:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.type:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.media:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.href:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.addedBy:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))!=null?s:"")+' data-dynamic="true" />'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-link",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=this.get("photo-privacy"),i=e.url(),s=t.getFieldsForDisplay(),o="",u=this,a=[{id:"canonicalurl",rel:"canonical",href:i+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:i+"/services/oembed?url="+encodeURI(i+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];s["al:ios:url"]||(s["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),o+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||n.getValue("title")})+"\n";var f="noarchive";return r.getValue("isPublic")||(f+=", noindex"),o+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:f}),o+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:f}),Object.keys(s).forEach(function(e){typeof s[e]=="object"&&e==="pinterest"?o+=u.templates("head-meta")({metaName:e,noPin:!0,metaValue:s[e].nopin,metaDescription:s[e].reason,isName:!0})+"\n":e==="og:description"?o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n":e==="title"?o+=u.templates("head-meta")({isName:!0,metaName:"title",metaValue:s[e]})+"\n":e==="keywords"?o+=u.templates("head-meta")({isName:!0,metaName:e,metaValue:s[e]})+"\n":e==="noindexfollow"?s[e]&&(s[e]>0||s[e]!=="")&&(o+=u.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",o+=u.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):o+=u.templates("head-meta")({metaName:e,metaValue:s[e]})+"\n"}),a.forEach(function(e){e.addedBy=u.name,o+=u.templates("head-link")(e)+"\n"}),this.set("headContainer",o),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("hermes-lang-meta_zh-hant-hk",function(e,t){e.Intl.add("hermes/meta","zh-Hant-HK",{PHOTOSTREAM:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684 ",{type:"plural",valueName:"photoCount",options:{one:"\u5f35\u76f8\u7247\uff01",other:"${#} \u5f35\u76f8\u7247\uff01"}}],PHOTOSTREAM_NO_PHOTOS:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684\u76f8\u7247\uff01"],ALBUMS_LIST:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684 ",{type:"plural",valueName:"photoCount",options:{one:"\u500b\u76f8\u7c3f\uff01",other:"${#} \u500b\u76f8\u7c3f\uff01"}}],ALBUMS_LIST_NO_ALBUMS:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684\u76f8\u7c3f\uff01"],FAVORITES:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u7684 ",{type:"plural",valueName:"photoCount",options:{one:"\u5f35\u52a0\u5165\u6700\u611b\u7684\u76f8\u7247\uff01",other:"${#} \u5f35\u52a0\u5165\u6700\u611b\u7684\u76f8\u7247\uff01"}}],FAVORITES_NO_PHOTOS:["\u767c\u6398 ","${username}"," \u5728 Flickr \u4e0a\u52a0\u5165\u6700\u611b\u7684\u76f8\u7247\uff01"],META_DESCRIPTION_BY_USER_ON_FLICKR:["\u7531 ","${username}"," \u5728 Flickr\u00b7\u4e0a\u767c\u4f48"],PHOTOSTREAM_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${username}"," \u6240\u6709\u76f8\u7247\u7684 Atom Feed"],FAVORITES_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${username}"," \u6700\u611b\u7684 Atom Feed"],GROUP_POOL_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${groupName}"," \u76f8\u7247\u7684 Atom Feed"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr\uff1a \u6709\u95dc ","${groupName}"," \u8a0e\u8ad6\u7684 Atom Feed"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.enableZoom=this.appContext.flipper.isFlipped("enable-scrappy-zoom"),this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t=this.subviews["photo-well-view"].get("container");return t.addClass("scrappy-photo-page-enabled"),t.addClass("is-real-fullscreen"),this.enableZoom&&t.addClass("enable-zoom"),this.setContainerWithTemplate("photo-page-lightbox",{"photo-well-view":t}),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","photo-css","util-css","fletrics","ttfp-recorder-plugin","signin-helper","url","fluid-css"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
