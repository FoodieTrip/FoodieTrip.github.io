YUI.add("hermes-lang-feedback_zh-hant-hk",function(e,t){e.Intl.add("hermes/feedback","zh-Hant-HK",{HELP_AND_FEEDBACK:["\u8aaa\u660e &amp; \u610f\u898b"],FEEDBACK_LINK:["\u5c0d\u96c5\u864e\u9996\u9801\u7684\u610f\u898b"],FAQS_LINK:["\u5e38\u898b\u554f\u984c"],OPT_OUT_LINK:["\u9078\u64c7\u9000\u51fa\u5168\u65b0\u7684\u76f8\u7247\u9ad4\u9a57"]})},"@VERSION@",{requires:["intl"]});
YUI.add("search-photos-unified-page-view",function(e){var t=e.url("/help/forum/en-us/72157651248603362/lastpage#reply"),n="search-photos-feedback",r=244,i=34;e.namespace("Views")[this.name]=e.Base.create("search-photos-unified-page-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n,i;return this.appContext.flipper.isFlipped("enable-slender-advanced-search")&&(r=100),this.unifiedSubviewParams=t.unifiedSubviewParams||{},n=this.unifiedSubviewParams.everyone&&this.unifiedSubviewParams.everyone.fetchParams?this.unifiedSubviewParams.everyone.fetchParams.apiParams:{},this.searchUrl=new e.SearchUrl(n,this.appContext,e.SearchUrl.searchTypes.PHOTOS),this.apiParams=this.searchUrl.getAPIParams(),this.searchTerm=t.searchTerm,this.apiFailed=t.apiFailed,i=this.name.replace(/-/g,"_"),YUI.Env.isServer&&e.config.flickr.paft_metrics_samples&&e.config.flickr.paft_metrics_samples[i]&&(t.paft=!0),YUI.Env.isServer||this.appContext.clientMetrics.setPendingMeasurement(this.name,!0),t.sortMenuItems=this.buildSortMenuItems(this.apiParams,!this.appContext.flipper.isFlipped("enable-slender-advanced-search")),this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,isSearchResults:!0},"search-subnav-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,selectedTabKey:"photos"},"search-subnav-slender-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"search-empty-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"search-photos-yours-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.yours}},"search-photos-contacts-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.contacts}},"search-photos-albums-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.albums}},"search-slender-advanced-panel-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"search-photos-everyone-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(){return!this.unifiedSubviewParams.everyone}},"feedback-widget-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,feedbackUrl:t,trackingSlk:n,hidden:!0},"signup-footer-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,pageType:"search",disabled:function(e){return e.isMobile||!this.appContext.flipper.isFlipped("enable-mini-sign-up-footer")||this.appContext.getViewer().signedIn||this.appContext.lang!=="en-US"}},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var t=this,n={};return this.apiFailed||!this.unifiedSubviewParams?e.Promise.resolve():(this.unifiedSubviewParams.everyone&&(n.everyone=this.appContext.getModel("search-photos-lite-models",this.unifiedSubviewParams.everyone.id,this.unifiedSubviewParams.everyone.fetchParams)),this.unifiedSubviewParams.yours&&(n.yours=this.appContext.getModel("search-photos-lite-models",this.unifiedSubviewParams.yours.id,this.unifiedSubviewParams.yours.fetchParams)),this.unifiedSubviewParams.contacts&&(n.contacts=this.appContext.getModel("search-photos-lite-models",this.unifiedSubviewParams.contacts.id,this.unifiedSubviewParams.contacts.fetchParams)),this.unifiedSubviewParams.albums&&(n.albums=this.appContext.getModel("search-sets-models",this.unifiedSubviewParams.albums.id,this.unifiedSubviewParams.albums.fetchParams)),e.FlickrPromise(n).then(function(e){t.subviewVisibility=t.determineSubviewVisibility(e),t.subviewVisibility.empty&&(e.everyone&&!e.everyone.getValue("emptyQuery")||e.albums&&!e.albums.getValue("emptyQuery"))&&(t.subviews["search-empty-view"].set("noMatchesForQuery",t.buildNoMatchesFoundMessage()),t.subviews["search-empty-view"].fire("parentViewEvent","error-msg-updated")),YUI.Env.isServer||t.beaconIfAllAFTResultsComplete("atfVisible")}))},buildContainer:function(){var t,n=this.appContext.flipper.isFlipped("enable-slender-advanced-search");return n&&(this.advancedPanelVisible=this.subviews["search-slender-advanced-panel-view"].getStoredAdvancedOptionsState()),t={"search-subnav-view":n?this.subviews["search-subnav-slender-view"].get("container"):this.subviews["search-subnav-view"].get("container"),useSlenderAdvancedPanel:this.appContext.flipper.isFlipped("enable-slender-advanced-search"),showEmpty:!this.subviewVisibility||this.subviewVisibility.empty,showAlbums:this.subviewVisibility&&this.subviewVisibility.albums,showEveryones:this.subviewVisibility&&this.subviewVisibility.everyone,showContacts:this.subviewVisibility&&this.subviewVisibility.contacts,showYours:this.subviewVisibility&&this.subviewVisibility.yours,viewingAll:this.searchUrl.getAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll),advancedPanelVisible:this.advancedPanelVisible,globalNavRestyleFlipped:this.appContext.flipper.isFlipped("global-nav-restyle")},["search-empty-view","search-photos-yours-view","search-photos-albums-view","search-photos-contacts-view","search-photos-everyone-view"].forEach(function(e){this.subviews[e]&&(t[e]=this.subviews[e].get("container"))}.bind(this)),this.setContainerWithTemplate("search-photos-unified-page-view",t),this},buildHeadContainer:function(){var e="",t=this;["search-photos-yours-view","search-photos-albums-view","search-photos-contacts-view","search-photos-everyone-view"].forEach(function(n){t.subviews[n]&&(e+=t.subviews[n].get("headContainer"))}),this.set("headContainer",e)},activate:function(){return this.fire("parentViewEvent","unhideFeedbackWidget"),e.later(100,this,function(){e.use("photo-page-scrappy-view")}),this},determineSubviewVisibility:function(e){var t={everyone:!!e.everyone&&!!e.everyone.getValue("totalItems"),yours:!!e.yours&&!!e.yours.getValue("totalItems"),contacts:!!e.contacts&&!!e.contacts.getValue("totalItems"),albums:!!e.albums&&!!e.albums.getValue("totalItems")};return t.empty=!t.everyone&&!t.yours&&!t.contacts&&!t.albums,t},buildSortMenuItems:function(t,n){var r=(new e
.SearchUrl(t,this.appContext)).setSearchType(e.SearchUrl.searchTypes.PHOTOS),i;return i=[{text:this.intlMessage({intlName:"search.RELEVANT"}),value:e.SearchHelper.API_SORT_OPTIONS.relevant,href:n?r.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.relevant).getURL():null,isDefault:!0},{text:this.intlMessage({intlName:"search.DATE_UPLOADED"}),value:e.SearchHelper.API_SORT_OPTIONS.dateUploaded,href:n?r.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.dateUploaded).getURL():null},{text:this.intlMessage({intlName:"search.DATE_TAKEN"}),value:e.SearchHelper.API_SORT_OPTIONS.dateTaken,href:n?r.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.dateTaken).getURL():null},{text:this.intlMessage({intlName:"search.INTERESTING"}),value:e.SearchHelper.API_SORT_OPTIONS.interesting,href:n?r.setAPIParam("sort",e.SearchHelper.API_SORT_OPTIONS.interesting).getURL():null}],i},buildNoMatchesFoundMessage:function(){var t,n,r=this.appContext.getViewer();return this.apiParams.user_id?r.signedIn&&this.apiParams.user_id===r.nsid?this.searchTerm?n="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_YOUR":n="search.NO_MATCHES_FOR_QUERY_TERM_YOUR":this.searchTerm?n="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_USER":n="search.NO_MATCHES_FOR_QUERY_TERM_USER":this.apiParams.contacts?this.searchTerm?n="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_CONTACTS":n="search.NO_MATCHES_FOR_QUERY_TERM_CONTACTS":this.apiParams.group_id?this.searchTerm?n="search.NO_MATCHES_FOR_QUERY_TERM_CONTEXT_GROUP":n="search.NO_MATCHES_FOR_QUERY_TERM_GROUP":this.searchTerm?n="search.NO_MATCHES_FOR_QUERY_TERM":n="search.NO_MATCHES_FOR_QUERY",this.searchTerm?t=this.intlMessage({intlName:n,searchTerm:e.flutil.unescape(this.searchTerm)}):t=this.intlMessage({intlName:n}),{noMatchesText:t}},onSubviewEvent:function(e,t){if(!t)return;var n=t[0];switch(n){case"dirty":case"search:dirty":this.get("container").addClass("dirty");break;case"atfVisible":this.handleAFTResult(e,t);break;case"bigScotch":this.bigScotch(t);break;case"footerDisplayChanged":this.fire("parentViewEvent","footerDisplayChanged");break;case"search:layoutChange":typeof t[1]!="undefined"&&this.fire("parentViewEvent","search:layoutChange",t[1]);break;case"search:startAdvancedPanelTransition":typeof t[1]!="undefined"&&this.handleAdvancedPanelTransitionStart(t[1]);break;case"search:finishAdvancedPanelTransition":typeof t[1]!="undefined"&&this.handleAdvancedPanelTransitionEnd(t[1]);break;default:t[2]&&t[2]==="toggle-advanced"&&this.toggleAdvancedSearch()}},handleAdvancedPanelTransitionStart:function(t){var n=this.get("container").one("main"),s;t?(s=!this.showEmpty&&e.config.win.pageYOffset>i,s||(n.addClass("advanced-panel-transition"),n.addClass("advanced-panel-visible"),e.flutil.onTransitionEnd(n,function(){n.removeClass("advanced-panel-transition")})),this.advancedPanelVisible=!0):(s=!this.showEmpty&&e.config.win.pageYOffset>r,s||(n.addClass("advanced-panel-transition"),n.removeClass("advanced-panel-visible"),e.flutil.onTransitionEnd(n,function(){n.removeClass("advanced-panel-transition")})),this.advancedPanelVisible=!1)},handleAdvancedPanelTransitionEnd:function(t){var n=this.get("container").one("main"),s,o;t?(s=!this.showEmpty&&e.config.win.pageYOffset>i,s&&(n.addClass("advanced-panel-visible"),window.scrollBy(0,r))):(s=!this.showEmpty&&e.config.win.pageYOffset>r,s&&(o=Math.min(r,e.config.win.document.body.scrollHeight-e.config.win.innerHeight-e.config.win.pageYOffset),n.removeClass("advanced-panel-visible"),window.scrollBy(0,-o)))},toggleAdvancedSearch:function(){this.advancedPanelVisible?this.closeAdvancedPanel():this.openAdvancedPanel()},openAdvancedPanel:function(){var t=this.get("container").one(".advanced-search-wrapper"),n=this.get("container").one("main"),s;s=!this.showEmpty&&e.config.win.pageYOffset>i,s?(n.addClass("advanced-panel-opening"),t.removeClass("collapsed"),this.subviews["search-slender-advanced-panel-view"].fire("parentViewEvent","open-advanced"),this.advancedPanelVisible=!0,e.flutil.onTransitionEnd(t,function(){n.removeClass("advanced-panel-opening"),n.addClass("advanced-panel-visible"),window.scrollBy(0,r)})):(t.removeClass("collapsed"),n.addClass("advanced-panel-visible"),this.subviews["search-slender-advanced-panel-view"].fire("parentViewEvent","open-advanced"),this.advancedPanelVisible=!0)},closeAdvancedPanel:function(){var t=this.get("container").one(".advanced-search-wrapper"),n=this.get("container").one("main"),i,s;i=!this.showEmpty&&e.config.win.pageYOffset>r,i?(n.addClass("advanced-panel-collapsing"),t.addClass("collapsed"),this.subviews["search-slender-advanced-panel-view"].fire("parentViewEvent","collapse-advanced"),this.advancedPanelVisible=!1,s=Math.min(r,e.config.win.document.body.scrollHeight-e.config.win.innerHeight-e.config.win.pageYOffset),e.flutil.onTransitionEnd(t,function(){n.removeClass("advanced-panel-collapsing"),n.removeClass("advanced-panel-visible"),window.scrollBy(0,-s)})):(t.addClass("collapsed"),n.removeClass("advanced-panel-visible"),this.subviews["search-slender-advanced-panel-view"].fire("parentViewEvent","collapse-advanced"),this.advancedPanelVisible=!1)},handleAFTResult:function(e,t){var n=t[0];this.paftResults||(this.paftResults={},this.showYours&&this.subviews["search-photos-yours-view"]&&(this.paftResults["search-photos-yours-view"]={}),this.showContacts&&this.subviews["search-photos-contacts-view"]&&(this.paftResults["search-photos-contacts-view"]={}),this.showEveryones&&this.subviews["search-photos-everyone-view"]&&(this.paftResults["search-photos-everyone-view"]={})),this.paftResults[e]&&(this.paftResults[e][n]=t[1]||(new Date).getTime()),this.beaconIfAllAFTResultsComplete(n)},beaconIfAllAFTResultsComplete:function(t){var n=0,r;if(this.allResultsReceived)return;if(!this.paftResults||typeof this.paftResults!="object")return;this.showAlbums||delete this.paftResults["search-photos-albums-view"],this.showYours||delete this.paftResults["search-photos-yours-view"],this.showContacts||delete this.paftResults["search-photos-contacts-view"],this.showEveryones||delete 
this.paftResults["search-photos-everyone-view"],this.allResultsReceived=Object.keys(this.paftResults).every(function(e){return r=this.paftResults[e][t],typeof r=="undefined"?!1:(r>n&&(n=r),!0)}.bind(this)),this.allResultsReceived&&t==="atfVisible"&&(this.appContext.hasClientSideRouted()?(this.appContext.clientMetrics.mark("AFT_CL",n),this.appContext.clientMetrics.mark("AFT",n)):(e.config.win.performance&&e.config.win.performance.timing&&(n-=e.config.win.performance.timing.navigationStart),this.appContext.clientMetrics.record("AFT_SV",n),this.appContext.clientMetrics.record("AFT",n)),this.appContext.clientMetrics.setPendingMeasurement(this.name,!1),this.appContext.clientMetrics.beacon())},bigScotch:function(t){var n=t&&t[1],r=this.searchUrl.getAPIParam(e.SearchHelper.API.excludeUserId)||"";if(!n)return;r&&(r+=","),r+=n,this.searchUrl.setAPIParam(e.SearchHelper.API.excludeUserId,r),this.appContext.flapp.navigate(this.searchUrl.getURL())}},{ATTRS:{spaceid:{value:792600534}}})},"@VERSION@",{requires:["url","flutil","flickr-view","flickr-promise","search-helper","hermes-template-search-photos-unified-page-view","search-subnav-view","search-subnav-slender-view","search-empty-view","search-photos-albums-view","search-photos-yours-view","search-photos-contacts-view","search-slender-advanced-panel-view","search-photos-everyone-view","search-url","search-unified-css","flickrui-css","feedback-widget-view","footer-full-view","querystring-stringify-simple","search-photos-lite-models"],langBundles:["search"]});
YUI.add("search-photos-route",function(e,t){function r(e){r.superclass.constructor.call(this,e)}var n=require("lib/flog")(t);e.Routes[this.name]=r,e.extend(r,e.FlickrRoute,{langBundles:this.details.langBundles,run:function(t){var r={},i=this,s,o=!0,u=!0,a,f,l,c={};r.apiParams=this.processRequest(t),r.viewerNsid=t.probableUser||this.appContext.getViewer().nsid,s=r.apiParams[e.SearchHelper.API.text]||r.apiParams[e.SearchHelper.API.tags],!s&&!this.appContext.flipper.isFlipped("enable-slender-advanced-search")&&(o=!1),r.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]&&r.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]&&(u=!1,o=!1);switch(r.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.viewType]){case"thumbs":a=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.thumbs;break;case"tiles":a=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.tiles;break;case"justified":a=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified}return l=this.generateUnifiedSubviewParams(r),l.everyone&&(c.everyone=this.appContext.getModel("search-photos-lite-models",l.everyone.id,l.everyone.fetchParams)),l.yours&&(c.yours=this.appContext.getModel("search-photos-lite-models",l.yours.id,l.yours.fetchParams)),l.contacts&&(c.contacts=this.appContext.getModel("search-photos-lite-models",l.contacts.id,l.contacts.fetchParams)),l.albums&&(c.albums=this.appContext.getModel("search-sets-models",l.albums.id,l.albums.fetchParams)),!a&&r.viewerNsid&&(c.viewerPrefs=this.appContext.getModel("person-preferences-models",r.viewerNsid)),f=t.query&&parseFloat(t.query.row_height)||1,f=Math.max(.5,Math.min(4,f)),e.FlickrPromise(c).then(function(t){a||(t.viewerPrefs?a=t.viewerPrefs.getValue("unifiedSearchViewPref"):a=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPE_DEFAULT),i.appContext.flipper.isFlipped("search-tiles")||a===e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.tiles&&(a=e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPE_DEFAULT);var n=r.apiParams[e.SearchHelper.API.text]||r.apiParams[e.SearchHelper.API.tags],s=i.intlMessage({intlName:"search.SEARCH"});return n!==undefined&&(s+=": "+n),e.Promise.resolve({view:"search-photos-unified-page-view",params:{unifiedSubviewParams:l,searchType:e.SearchUrl.searchTypes.PHOTOS,searchTerm:n,modelParams:r,showTools:o,showAdvanced:u,showSort:o,viewType:a,rowHeightMod:f},layout:"scrolling",fluid:!0,title:s})},function(t){n.error({err:t});var s=r.apiParams[e.SearchHelper.API.text]||r.apiParams[e.SearchHelper.API.tags],o=i.intlMessage({intlName:"search.SEARCH"});return s!==undefined&&(o+=": "+s),e.Promise.resolve({view:"search-photos-unified-page-view",params:{searchTerm:s,apiFailed:!0,modelParams:r},fluid:!0,title:o})})},generateUnifiedSubviewParams:function(t){var n={},r=t.apiParams,i;return e.SearchHelper.isParameterlessSearch(r)?n:(this.shouldPerformEveryoneSearch(t,r)&&(i=new e.SearchUrl(r,this.appContext,e.SearchUrl.searchTypes.PHOTOS),n.everyone={id:i.getId(),fetchParams:{apiParams:i.getAPIParams(),perPage:25}}),this.shouldPerformYoursSearch(t,r)&&(i=new e.SearchUrl(e.merge({user_id:t.viewerNsid,sort:e.SearchHelper.API_SORT_OPTIONS.dateTaken},r),this.appContext,e.SearchUrl.searchTypes.PHOTOS),n.yours={id:i.getId(),fetchParams:{apiParams:i.getAPIParams(),perPage:20}}),this.shouldPerformContactsSearch(t,r)&&(i=new e.SearchUrl(e.merge(r,{contacts:"all"}),this.appContext,e.SearchUrl.searchTypes.PHOTOS),n.contacts={id:i.getId(),fetchParams:{apiParams:i.getAPIParams(),perPage:20}}),this.shouldPerformAlbumsSearch(t,r)&&(i=new e.SearchUrl(e.merge(r,{user_id:t.viewerNsid}),this.appContext,e.SearchUrl.searchTypes.PHOTOS),n.albums={id:i.getId(),fetchParams:{apiParams:i.getAPIParams(),perPage:20}}),n)},shouldPerformEveryoneSearch:function(t,n){return!n[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]||!n[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]},shouldPerformYoursSearch:function(t,n){return t.viewerNsid&&!n[e.SearchHelper.API.userId]&&!n[e.SearchHelper.API.groupId]&&!n[e.SearchHelper.API.contacts]&&!n[e.SearchHelper.API.faves]&&!n[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]},shouldPerformContactsSearch:function(t,n){return t.viewerNsid&&!n[e.SearchHelper.API.userId]&&!n[e.SearchHelper.API.groupId]&&!n[e.SearchHelper.API.contacts]&&!n[e.SearchHelper.API.faves]&&!n[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]},shouldPerformAlbumsSearch:function(t,n){return!t.viewerNsid||!n[e.SearchHelper.API.text]?!1:parseInt(n[e.SearchHelper.API.marketplace])?!1:n[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]?!0:!n[e.SearchHelper.API.userId]&&!n[e.SearchHelper.API.groupId]&&!n[e.SearchHelper.API.contacts]&&!n[e.SearchHelper.API.faves]&&!n[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]},processRequest:function(t){var n={};return n=e.merge(t.query,e.SearchHelper.mapRouteParamsToAPI(t.params)),n=e.SearchHelper.mapClassicSearchToAPI(n,this.appContext),e.SearchHelper.addParamDefaults(n),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(n),n}}),e.mix(r.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-route","flickr-promise","search-helper","localizable","search-photos-lite-models","search-sets-models","url","search-url","search-photos-unified-page-view","person-preferences-models"],langBundles:["search"]});
